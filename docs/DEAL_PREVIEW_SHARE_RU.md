# –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–¥–µ–ª–∫–∞–º

## –û–±–∑–æ—Ä

–§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–¥–µ–ª–∫–∞–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–¥–µ–ª–æ–∫, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª—é–±–æ–º—É, —É –∫–æ–≥–æ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–¥–µ–ª–∫–µ, –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ö–µ–º–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
- [Backend API](#backend-api)
- [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è Frontend](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-frontend)
- [–í–æ–ø—Ä–æ—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–≤–æ–ø—Ä–æ—Å—ã-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é](#—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ-–ø–æ-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ —Å–∏—Å—Ç–µ–º—ã

```
–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î ‚Üí –í–æ–∑–≤—Ä–∞—Ç URL
                                                                ‚Üì
–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø ‚Üí –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚Üí –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Backend**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—É–±–ª–∏—á–Ω—ã–µ API endpoints
2. **Frontend**: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Ñ–ª–∞–≥–æ–≤ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ Deals

**–§–∞–π–ª**: `/packages/db/src/schema/deal.ts`

```typescript
{
  isPublic: boolean("is_public").default(false).notNull(),
  publicShareToken: varchar("public_share_token", { length: 64 }).unique(),
}
```

### –ú–∏–≥—Ä–∞—Ü–∏—è

**–§–∞–π–ª**: `/packages/db/src/migrations/0003_add_deal_public_sharing.sql`

```sql
ALTER TABLE deals
ADD COLUMN is_public BOOLEAN DEFAULT FALSE NOT NULL,
ADD COLUMN public_share_token VARCHAR(64) UNIQUE;

CREATE INDEX idx_deals_public_share_token ON deals(public_share_token);
```

---

## Backend API

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏

**Endpoint**: `POST /deals/:dealId/share`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –¢—Ä–µ–±—É–µ—Ç—Å—è (Bearer token)

**–ó–∞–ø—Ä–æ—Å**:
```bash
POST /deals/{dealId}/share
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "shareToken": "a1b2c3d4e5f6...", // 64-—Å–∏–º–≤–æ–ª—å–Ω—ã–π –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ç–æ–∫–µ–Ω
  "shareUrl": "/preview/deals/a1b2c3d4e5f6...", // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–æ–º–µ–Ω–∞)
  "isPublic": true
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: `/packages/backend/src/routes/deal.ts:1492-1575`

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π 64-—Å–∏–º–≤–æ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –∏—Å–ø–æ–ª—å–∑—É—è `crypto.getRandomValues()`
- –ü–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω, –µ—Å–ª–∏ —Å–¥–µ–ª–∫–∞ —É–∂–µ –ø—É–±–ª–∏—á–Ω–∞—è
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `isPublic: true` –¥–ª—è —Å–¥–µ–ª–∫–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å URL (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º –¥–æ–º–µ–Ω–µ)

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞**:
```typescript
function generateShareToken(): string {
  const array = new Uint8Array(32);
  crypto.getRandomValues(array);
  return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
}
```

### 2. –î–æ—Å—Ç—É–ø –∫ –ø—É–±–ª–∏—á–Ω–æ–π —Å–¥–µ–ª–∫–µ

**Endpoint**: `GET /deals/:shareToken?token=:shareToken`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)

**–ó–∞–ø—Ä–æ—Å**:
```bash
GET /deals/{shareToken}?token={shareToken}
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "id": "deal-uuid",
  "receiverBin": "123456789012",
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏",
  "dealType": "service",
  "totalAmount": 100000,
  "paidAmount": 50000,
  "status": "active",
  "isPublic": true,
  "publicShareToken": "token...",
  "documentsFlutter": [...],
  "comments": [...]
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: `/packages/backend/src/routes/deal.ts:1310-1398`

### 3. –ü—É–±–ª–∏—á–Ω—ã–µ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–µ endpoints

–í—Å–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–∞–ø—Ä–æ—Å–∞ `?token=:shareToken` –¥–ª—è –Ω–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:

- `GET /deals/:dealId/balance?token=:shareToken` - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–ª–∞–Ω—Å–µ
- `GET /deals/:dealId/reconciliation?token=:shareToken` - –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç —Å–≤–µ—Ä–∫–∏
- `GET /deals/:dealId/transactions?token=:shareToken` - –ü–æ–ª—É—á–∏—Ç—å –∂—É—Ä–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–æ–¥–∫–∏

**–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞**:
```typescript
async function validateShareToken(db: any, shareToken: string) {
  const deal = await db.query.deals.findFirst({
    where: and(
      eq(deals.publicShareToken, shareToken),
      eq(deals.isPublic, true)
    ),
    with: {
      dealDocumentsFlutter: { with: { documentFlutter: true } },
      comments: { with: { author: true } }
    },
  });
  return deal;
}
```

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Frontend

### –ú–∞—Ä—à—Ä—É—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞

**–§–∞–π–ª**: `/packages/frontend/src/routes/preview/deals/$shareToken/index.tsx`

**–ú–∞—Ä—à—Ä—É—Ç**: `/preview/deals/:shareToken`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- Graceful –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å `Promise.allSettled`
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω (mobile-first)

### –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```typescript
loader: async ({ params }) => {
  const shareToken = params.shareToken;

  // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  const [dealRes, balanceRes, reconciliationRes, transactionsRes] =
    await Promise.allSettled([
      api.get(`/deals/${shareToken}`, { params: { token: shareToken } }),
      api.get(`/deals/${shareToken}/balance`, { params: { token: shareToken } }),
      api.get(`/deals/${shareToken}/reconciliation`, { params: { token: shareToken } }),
      api.get(`/deals/${shareToken}/transactions`, { params: { token: shareToken } }),
    ]);

  return {
    deal: dealRes.status === "fulfilled" ? dealRes.value.data : null,
    balance: balanceRes.status === "fulfilled" ? balanceRes.value.data : null,
    reconciliation: reconciliationRes.status === "fulfilled" ? reconciliationRes.value.data : null,
    transactions: transactionsRes.status === "fulfilled" ? transactionsRes.value.data : null,
  };
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
DealPreviewComponent
‚îú‚îÄ‚îÄ DealPreviewHeader (–∑–∞–≥–æ–ª–æ–≤–æ–∫, —Å—Ç–∞—Ç—É—Å, –±–µ–π–¥–∂–∏)
‚îú‚îÄ‚îÄ DealInfoSection (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏, —Å—É–º–º—ã)
‚îú‚îÄ‚îÄ AccountingDetailsSection (–±–∞–ª–∞–Ω—Å, –∂—É—Ä–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–æ–¥–∫–∏, –∞–∫—Ç —Å–≤–µ—Ä–∫–∏)
‚îú‚îÄ‚îÄ CommentsSection (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è)
‚îî‚îÄ‚îÄ DocumentsSection (—Å–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–§–∞–π–ª—ã**:
- `/packages/frontend/src/components/deal-preview/DealPreviewHeader.tsx`
- `/packages/frontend/src/components/deal-preview/DealInfoSection.tsx`
- `/packages/frontend/src/components/deal-preview/AccountingDetailsSection.tsx`
- `/packages/frontend/src/components/deal-preview/CommentsSection.tsx`
- `/packages/frontend/src/components/deal-preview/DocumentsSection.tsx`

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

–î–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `filePath` –Ω–∞–ø—Ä—è–º—É—é, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π URL Supabase:

```typescript
// DocumentsSection.tsx
useEffect(() => {
  if (doc.filePath) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º filePath –Ω–∞–ø—Ä—è–º—É—é (—É–∂–µ –ø–æ–ª–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π URL Supabase)
    const isImg = /\.(jpeg|jpg|gif|png|webp)$/i.test(doc.filePath);
    if (isImg) {
      setPreviewUrl(doc.filePath);
    }
  }
}, [doc.filePath]);
```

**–í–∞–∂–Ω–æ**: –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `supabase.storage.getPublicUrl()` –¥–ª—è `filePath`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —É–∂–µ –ø–æ–ª–Ω—ã–π URL.

---

## –í–æ–ø—Ä–æ—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤

1. **–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `crypto.getRandomValues()` –¥–ª—è 64-—Å–∏–º–≤–æ–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤
3. **–ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω**: –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞

1. **–ü—É–±–ª–∏—á–Ω—ã–π —Ñ–ª–∞–≥**: –¢—Ä–µ–±—É–µ—Ç—Å—è –∏ –≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω, –ò `isPublic: true`
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞**: –í—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ endpoints –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö
3. **–û—Ç–∑—ã–≤**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `isPublic: false` –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø

### –†–∞—Å–∫—Ä—ã—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ü—É–±–ª–∏—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç:
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–¥–µ–ª–∫–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—É–º–º—ã, —Å—Ç–∞—Ç—É—Å, –æ–ø–∏—Å–∞–Ω–∏–µ)
- ‚úÖ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ (–±–∞–ª–∞–Ω—Å, –∂—É—Ä–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–æ–¥–∫–∏, –∞–∫—Ç —Å–≤–µ—Ä–∫–∏)
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç—ã (–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)

–ü—É–±–ª–∏—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –ù–ï —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç:
- ‚ùå –î–∞–Ω–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå –í–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–º –ª–∏—Ü–µ
- ‚ùå –î—Ä—É–≥–∏–µ —Å–¥–µ–ª–∫–∏ —Ç–æ–≥–æ –∂–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞
- ‚ùå –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Backend/API

#### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏

```bash
curl -X POST http://localhost:3000/deals/{dealId}/share \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json"
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "shareToken": "fd81c8d0e4e2e486ae09499d0a8498d5129ab22a975281a1c18f348b1443cded",
  "shareUrl": "/preview/deals/fd81c8d0e4e2e486ae09499d0a8498d5129ab22a975281a1c18f348b1443cded",
  "isPublic": true
}
```

#### 2. –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π

–ü–æ–ª–Ω—ã–π URL –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞:
- **Localhost**: `http://localhost:3000/preview/deals/{shareToken}`
- **Production**: `https://infobuh.com/preview/deals/{shareToken}`

`shareUrl`, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π API, –Ω–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç –¥–æ–º–µ–Ω–∞ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –µ–º—É —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –ª—é–±–æ–º –¥–æ–º–µ–Ω–µ.

#### 3. –û—Ç–∑—ã–≤ –¥–æ—Å—Ç—É–ø–∞

–ß—Ç–æ–±—ã –æ—Ç–æ–∑–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–¥–µ–ª–∫—É:

```bash
curl -X PUT http://localhost:3000/deals/{dealId} \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"isPublic": false}'
```

#### 4. –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞

–ß—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω (–¥–µ–ª–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º), –æ–±–Ω–æ–≤–∏—Ç–µ —Å–¥–µ–ª–∫—É:

```bash
# –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ isPublic –≤ false
curl -X PUT http://localhost:3000/deals/{dealId} \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"isPublic": false, "publicShareToken": null}'

# –ó–∞—Ç–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—É—é –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É
curl -X POST http://localhost:3000/deals/{dealId}/share \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Frontend

#### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ UI –∫–Ω–æ–ø–∫—É, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç endpoint –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

#### 2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏

```typescript
const handleShare = async (dealId: string) => {
  const response = await api.post(`/deals/${dealId}/share`);
  const { shareUrl } = response.data;

  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ URL
  const fullUrl = `${window.location.origin}${shareUrl}`;

  // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
  await navigator.clipboard.writeText(fullUrl);
  toast.success("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
};
```

#### 3. –î–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞: `/preview/deals/{shareToken}`

–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

**–§–∞–π–ª**: `/packages/backend/src/test-deal-accounting.ts`

**–§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∞**: `testDealPreviewURLGeneration()` (–°—Ç—Ä–æ–∫–∏ 1735-1946)

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏**:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–¥–µ–ª–∫–∏
2. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ (64 —Å–∏–º–≤–æ–ª–∞)
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ —Å `isPublic` –∏ `publicShareToken`
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω
5. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞
6. ‚úÖ –°–∏–º—É–ª—è—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –Ω–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
7. ‚úÖ –û—Ç–∑—ã–≤ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
8. ‚úÖ –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–≥–æ —Ç–æ–∫–µ–Ω–∞)

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
cd packages/backend
bun run src/test-deal-accounting.ts
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥**:
```
üîó 17. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–¥–µ–ª–∫–∏
   üìã 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–¥–µ–ª–∫–∏
   ‚úÖ –°–¥–µ–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞
   üîê 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞
   ‚úÖ –¢–æ–∫–µ–Ω —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω (64 —Å–∏–º–≤–æ–ª–∞)
   üîç 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ç–æ–∫–µ–Ω—É
   ‚úÖ –°–¥–µ–ª–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Ç–æ–∫–µ–Ω—É
   üîê 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞
   ‚úÖ –¢–æ–∫–µ–Ω —É–Ω–∏–∫–∞–ª–µ–Ω
   üåê 5. –°–∏–º—É–ª—è—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
   ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç
   üîí 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
   ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø —É—Å–ø–µ—à–Ω–æ –æ—Ç–æ–∑–≤–∞–Ω
   üîÑ 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞
   ‚úÖ –¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏**:
   ```bash
   curl -X POST http://localhost:3000/deals/YOUR_DEAL_ID/share
   ```

2. **–î–æ—Å—Ç—É–ø –∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä—É** (–≤ –±—Ä–∞—É–∑–µ—Ä–µ):
   ```
   http://localhost:3000/preview/deals/SHARE_TOKEN
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞** (–±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏):
   ```bash
   curl http://localhost:3000/deals/SHARE_TOKEN?token=SHARE_TOKEN
   ```

4. **–¢–µ—Å—Ç –æ—Ç–∑—ã–≤–∞**:
   ```bash
   # –û—Ç–∑—ã–≤ –¥–æ—Å—Ç—É–ø–∞
   curl -X PUT http://localhost:3000/deals/YOUR_DEAL_ID \
     -d '{"isPublic": false}'

   # –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (–¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è)
   curl http://localhost:3000/deals/SHARE_TOKEN?token=SHARE_TOKEN
   ```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
packages/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ routes/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ deal.ts                    # Endpoints –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
‚îÇ       ‚îî‚îÄ‚îÄ test-deal-accounting.ts        # –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ schema/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ deal.ts                    # –°—Ö–µ–º–∞ —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
‚îÇ       ‚îî‚îÄ‚îÄ migrations/
‚îÇ           ‚îî‚îÄ‚îÄ 0003_add_deal_public_sharing.sql
‚îî‚îÄ‚îÄ frontend/
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ routes/
        ‚îÇ   ‚îú‚îÄ‚îÄ preview/
        ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route.tsx              # –û–±–µ—Ä—Ç–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞
        ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ deals/
        ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ $shareToken/
        ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ index.tsx      # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        ‚îÇ   ‚îî‚îÄ‚îÄ share/
        ‚îÇ       ‚îî‚îÄ‚îÄ deals/
        ‚îÇ           ‚îî‚îÄ‚îÄ $dealId/
        ‚îÇ               ‚îî‚îÄ‚îÄ $documentId.tsx # –ü—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        ‚îî‚îÄ‚îÄ components/
            ‚îî‚îÄ‚îÄ deal-preview/
                ‚îú‚îÄ‚îÄ DealPreviewHeader.tsx
                ‚îú‚îÄ‚îÄ DealInfoSection.tsx
                ‚îú‚îÄ‚îÄ AccountingDetailsSection.tsx
                ‚îú‚îÄ‚îÄ CommentsSection.tsx
                ‚îî‚îÄ‚îÄ DocumentsSection.tsx
```

---

## –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ API

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏

```typescript
POST /deals/:dealId/share
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `dealId` (path) - UUID —Å–¥–µ–ª–∫–∏

**–ó–∞–≥–æ–ª–æ–≤–∫–∏**:
- `Authorization: Bearer <token>` - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

**–û—Ç–≤–µ—Ç**:
```typescript
{
  shareToken: string;      // 64-—Å–∏–º–≤–æ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
  shareUrl: string;        // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å: "/preview/deals/{token}"
  isPublic: boolean;       // true
}
```

**–ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è**:
- `200` - –£—Å–ø–µ—à–Ω–æ
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `404` - –°–¥–µ–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- `500` - –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–¥–µ–ª–∫–µ

```typescript
GET /deals/:shareToken?token=:shareToken
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `shareToken` (path) - –¢–æ–∫–µ–Ω –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- `token` (query) - –¢–æ—Ç –∂–µ —Ç–æ–∫–µ–Ω –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–ó–∞–≥–æ–ª–æ–≤–∫–∏**: –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

**–û—Ç–≤–µ—Ç**:
```typescript
{
  id: string;
  receiverBin: string;
  title: string;
  description?: string;
  dealType: "service" | "product";
  totalAmount: number;
  paidAmount: number;
  status: "draft" | "active" | "completed" | "cancelled";
  isPublic: boolean;
  publicShareToken: string;
  createdAt: string;
  updatedAt: string;
  documentsFlutter: DocumentFlutter[];
  comments: Comment[];
}
```

**–ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è**:
- `200` - –£—Å–ø–µ—à–Ω–æ
- `404` - –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–ª–∏ —Å–¥–µ–ª–∫–∞ –Ω–µ –ø—É–±–ª–∏—á–Ω–∞—è

---

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. ‚úÖ –í—Å–µ–≥–¥–∞ –≤–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –∏ —Ç–æ–∫–µ–Ω, –ò —Ñ–ª–∞–≥ `isPublic`
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
3. ‚úÖ –†–µ–∞–ª–∏–∑—É–π—Ç–µ rate limiting –Ω–∞ endpoints –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
4. ‚úÖ –õ–æ–≥–∏—Ä—É–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø—É–±–ª–∏—á–Ω—ã–º —Å–¥–µ–ª–∫–∞–º –¥–ª—è –∞—É–¥–∏—Ç–∞
5. ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö (`Promise.allSettled`)
2. ‚úÖ –ö–µ—à–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω–¥–µ–∫—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ `publicShareToken`
4. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

### UX

1. ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —á–µ—Ç–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É"
2. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ Gracefully –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ (–∏—Å—Ç–µ–∫—à–∏–µ/–Ω–µ–≤–µ—Ä–Ω—ã–µ —Å—Å—ã–ª–∫–∏)
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ URL –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π –æ—Ç –¥–æ–º–µ–Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
5. ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–π—Ç–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ —Ä–µ–∂–∏–º–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è

---

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid share token or deal not publicly accessible"

**–ü—Ä–∏—á–∏–Ω–∞**: –¢–æ–∫–µ–Ω –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ `isPublic: false`

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏
curl http://localhost:3000/deals/DEAL_ID

# –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É
curl -X POST http://localhost:3000/deals/DEAL_ID/share
```

### –ü—Ä–æ–±–ª–µ–º–∞: URL –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `supabase.storage.getPublicUrl()` –Ω–∞ —É–∂–µ –ø–æ–ª–Ω—ã—Ö URL

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `filePath` –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ SDK:
```typescript
// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
const { data } = supabase.storage.from("documents").getPublicUrl(doc.filePath);

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
const url = doc.filePath; // –£–∂–µ –ø–æ–ª–Ω—ã–π URL
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ localhost, –Ω–æ –Ω–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

**–ü—Ä–∏—á–∏–Ω–∞**: –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–º–µ–Ω –≤ URL –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏:
```typescript
// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
const shareUrl = `http://localhost:3000/preview/deals/${token}`;

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
const shareUrl = `/preview/deals/${token}`;

// –ó–∞—Ç–µ–º –Ω–∞ frontend:
const fullUrl = `${window.location.origin}${shareUrl}`;
```

---

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–ò—Å—Ç–µ–∫–∞—é—â–∏–µ —Å—Å—ã–ª–∫–∏**: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏ `expiresAt` –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
2. **–ó–∞—â–∏—Ç–∞ –ø–∞—Ä–æ–ª–µ–º**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
3. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –ø–æ–ª—É—á–∏–ª –¥–æ—Å—Ç—É–ø –∫ –ø—É–±–ª–∏—á–Ω—ã–º —Å–¥–µ–ª–∫–∞–º
4. **–ö–∞—Å—Ç–æ–º–Ω—ã–π –±—Ä–µ–Ω–¥–∏–Ω–≥**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
6. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ email**: –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ email
7. **–í–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ –∫ –ø—É–±–ª–∏—á–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º

### –ò–¥–µ–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```typescript
// –ò—Å—Ç–µ–∫–∞—é—â–∏–µ —Å—Å—ã–ª–∫–∏
interface Deal {
  shareExpiresAt?: Date;
}

// –ó–∞—â–∏—Ç–∞ –ø–∞—Ä–æ–ª–µ–º
interface Deal {
  sharePassword?: string; // –•–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
}

// –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
interface ShareAccessLog {
  dealId: string;
  accessedAt: Date;
  ipAddress: string;
  userAgent: string;
}
```

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞–º:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –≤ `test-deal-accounting.ts`
- –ò–∑—É—á–∏—Ç–µ backend –º–∞—Ä—à—Ä—É—Ç—ã –≤ `packages/backend/src/routes/deal.ts`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `packages/frontend/src/components/deal-preview/`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-12-15
**–í–µ—Ä—Å–∏—è**: 1.0.0
